{% extends 'base.html' %}
{% block content %}
<h1>Track {{ courier.tracking_id }}</h1>
<p><strong>Status:</strong> {{ courier.status }}</p>
<p><strong>Sender:</strong> {{ courier.sender }}</p>
<p><strong>Receiver:</strong> {{ courier.receiver }}</p>

<!-- LIVE GOOGLE MAP -->
<div id="map" style="height: 500px; width: 100%;"></div>
<button onclick="updateGPS('{{ courier.tracking_id }}')" class="btn btn-warning mt-2">Update GPS Live</button>

<h3>Recent Locations</h3>
<ul class="list-group">
{% for loc in locations %}
<li class="list-group-item">
    Lat: {{ loc.latitude }}, Lng: {{ loc.longitude }} at {{ loc.timestamp }}
</li>
{% endfor %}
</ul>

<script>
let map;
function initMap() {
    map = new google.maps.Map(document.getElementById('map'), {
        zoom: 10,
        center: {lat: {{ locations[0].latitude if locations else 17.3850 }}, lng: {{ locations[0].longitude if locations else 78.4867 }}}
    });
    
    // Add markers for all locations
    {% for loc in locations %}
    new google.maps.Marker({
        position: {lat: {{ loc.latitude }}, lng: {{ loc.longitude }}},
        map: map,
        title: "{{ loc.timestamp }}"
    });
    {% endfor %}
}

function updateGPS(trackingId) {
    fetch(`/update_gps/${trackingId}`)
    .then(() => location.reload());
}
</script>
<script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDbmyBLrm6mVNB5qlbUU1B0Sxv6akrLpog&callback=initMap"></script>
{% endblock %}
